from elasticsearch import Elasticsearch
from elasticsearch_dsl import Search


# def fill_convertible_name_dic():
#     dic = {}
#     contents = open("../../resource/service_names.txt")
#     for line in contents.readlines():
#         parts = line.split(",")
#         dic[parts[0]] = to_standard_query(parts[1])
#     return dic

#
# def convert_name(name):
#     if name in convertible_dic:
#         return convertible_dic[name]
#     return name
#
#
# def to_standard_query(q):
#     q = str(q)
#     q = q.strip().lower()
#     q = q.replace(" ", "_")
#     return convert_name(q)


def elastic_search(configuration):
    return (Search(using=elastic, index="cve")
            .query("match", configuration=configuration))


elastic = Elasticsearch(hosts="81.91.136.83:9200")
# convertible_dic = fill_convertible_name_dic()


def cve_search(query):
    # query = to_standard_query(query)
    hits = elastic_search(query)

    results = []
    for result in hits:
        result = result.to_dict()
        result.pop('configuration')
        result.pop('date')
        result.pop('references')
        results.append(result)

    return results


cve_search("asfas")
